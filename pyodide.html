<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Python Web IDE (Pyodide)</title>

<script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/lib/codemirror.css">
<script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/lib/codemirror.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/mode/python/python.js"></script>

<style>
body {
  margin: 0;
  background: #1e1e1e;
  color: #ddd;
  font-family: system-ui;
  height: 100vh;
  overflow: hidden;
}

#app { display: flex; height: 100vh; }

/* LEFT PANEL */
#problem-panel {
  width: 30%;
  background: #252526;
  padding: 1rem;
  overflow-y: auto;
  border-right: 1px solid #333;
}

/* RIGHT PANEL */
#editor-panel {
  flex: 1;
  display: flex;
  flex-direction: column;
  padding: 1rem;
}

/* TOOLBAR */
.toolbar {
  display: flex;
  gap: 0.5rem;
  align-items: center;
  margin-bottom: 0.5rem;
}

button {
  background: #3a3d41;
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
}

button:hover { background: #505357; }

/* FILE BAR */
#file-bar {
  display: flex;
  gap: 0.5rem;
  align-items: center;
  margin-bottom: 0.5rem;
}

/* TABS */
#tabs {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
}

.tab {
  padding: 6px 12px;
  background: #333;
  border-radius: 6px 6px 0 0;
  cursor: pointer;
}

.tab.active {
  background: #1e1e1e;
  border-bottom: 2px solid cyan;
}

/* EDITOR */
#editor-wrapper {
  flex: 1;
  border: 1px solid #333;
  border-radius: 6px;
  overflow: hidden;
}

.CodeMirror {
  height: 100%;
  background: #1e1e1e;
  color: #fff;
}

/* OUTPUT */
#output-panel {
  margin-top: 0.5rem;
  background: #111;
  border-radius: 6px;
  padding: 0.5rem;
}

#output-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.3rem;
}

pre {
  background: #222;
  padding: 0.7rem;
  border-radius: 6px;
  max-height: 160px;
  overflow-y: auto;
  white-space: pre-wrap;
}

/* COPY ICON */
.copy-btn {
  cursor: pointer;
  font-size: 14px;
  opacity: 0.7;
}

.copy-btn:hover { opacity: 1; }

#status {
  margin-left: auto;
  font-size: 13px;
  color: #aaa;
}
</style>
</head>

<body>
<div id="app">

<!-- LEFT -->
<div id="problem-panel">
<h3>üìÅ Python Files</h3>

<select id="file-select" style="width:100%; margin-bottom:0.5rem;"></select>

<button onclick="loadSelectedFile()">üìÇ Load File</button>
<button onclick="previewFile()">üëÅ Preview</button>

<hr>

<p>Status:</p>
<div id="file-status">Waiting...</div>
</div>

<!-- RIGHT -->
<div id="editor-panel">

<div class="toolbar">
  <button onclick="runCode()">‚ñ∂ Run</button>
  <button onclick="copyEditor()">üìã Copy Code</button>
  <button onclick="copyOutput()">üìã Copy Output</button>
  <span id="status">Loading Pyodide‚Ä¶</span>
</div>

<div id="tabs">
  <div class="tab active" onclick="switchTab('main')">Main Code</div>
  <div class="tab" onclick="switchTab('preview')">Preview</div>
</div>

<div id="editor-wrapper">
  <textarea id="code">
print("Hello from Pyodide IDE!")
  </textarea>
</div>

<div id="output-panel">
  <div id="output-header">
    <strong>Output</strong>
  </div>
  <pre id="output">(Output)</pre>
</div>

</div>
</div>

<script>
let editor;
let pyodideReady = false;
let loadedFiles = {};
let currentTab = "main";
let previewContent = "";

editor = CodeMirror.fromTextArea(document.getElementById("code"), {
  mode: "python",
  lineNumbers: true,
  indentUnit: 4
});

/* ---------------- PYODIDE INIT ---------------- */

async function main() {
  window.pyodide = await loadPyodide();
  await pyodide.loadPackage(["numpy", "matplotlib"]);
  pyodideReady = true;
  document.getElementById("status").textContent = "Ready";

  await loadPythonFiles();
}
main();

/* -------- FILE LOADING LOGIC (IMPORTANT PART) -------- */

async function loadPythonFiles() {
  const files = ["hello_world.txt"];   // add more later automatically

  pyodide.FS.mkdir("python_text_files");

  const select = document.getElementById("file-select");
  select.innerHTML = "";

  for (const file of files) {
    try {
      const r = await fetch(`python_text_files/${file}`);
      const text = await r.text();

      pyodide.FS.writeFile(`python_text_files/${file}`, text);
      loadedFiles[file] = text;

      const opt = document.createElement("option");
      opt.value = file;
      opt.textContent = file;
      select.appendChild(opt);

      document.getElementById("file-status").textContent = "Files loaded ‚úî";

    } catch {
      document.getElementById("file-status").textContent = "Failed to load files ‚ùå";
    }
  }
}

/* -------- FILE ACTIONS -------- */

function loadSelectedFile() {
  const file = document.getElementById("file-select").value;
  if (!file) return;

  editor.setValue(loadedFiles[file]);
  switchTab("main");
}

function previewFile() {
  const file = document.getElementById("file-select").value;
  if (!file) return;

  previewContent = loadedFiles[file];
  editor.setValue(previewContent);
  switchTab("preview");
}

/* -------- TAB SYSTEM -------- */

function switchTab(tab) {
  currentTab = tab;

  document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
  document.querySelectorAll(".tab")[tab === "main" ? 0 : 1].classList.add("active");
}

/* -------- RUN CODE -------- */

async function runCode() {
  const output = document.getElementById("output");

  if (!pyodideReady) {
    output.textContent = "Loading Pyodide...";
    return;
  }

  try {
    await pyodide.runPythonAsync(`
import sys, io
sys.stdout = io.StringIO()
sys.stderr = sys.stdout
    `);

    await pyodide.runPythonAsync(editor.getValue());

    output.textContent =
      await pyodide.runPythonAsync("sys.stdout.getvalue()") || "(No output)";

  } catch (err) {
    output.textContent = err;
  }
}

/* -------- COPY BUTTONS -------- */

function copyEditor() {
  navigator.clipboard.writeText(editor.getValue());
}

function copyOutput() {
  navigator.clipboard.writeText(document.getElementById("output").textContent);
}
</script>
</body>
</html>