<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Python Web IDE + LeetCode (Pyodide)</title>

<script src="https://cdn.jsdelivr.net/pyodide/v0.25.0/full/pyodide.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/lib/codemirror.css">
<script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/lib/codemirror.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/mode/python/python.js"></script>
<script src="https://cdn.jsdelivr.net/npm/codemirror@5.65.16/addon/edit/matchbrackets.js"></script>

<style>
body {
  margin: 0;
  background: #1e1e1e;
  color: #ddd;
  font-family: system-ui;
  height: 100vh;
  overflow: hidden;
}

#app { display: flex; height: 100vh; }

/* LEFT PANEL */
#problem-panel {
  width: 32%;
  background: #252526;
  padding: 1rem;
  overflow-y: auto;
  border-right: 1px solid #333;
}

h2 { margin-top: 0; }

#problem-preview {
  margin-top: 1rem;
  background: #1a1a1a;
  padding: 0.8rem;
  border-radius: 6px;
  max-height: 50vh;
  overflow-y: auto;
  white-space: pre-wrap;
}

/* RIGHT PANEL */
#editor-panel {
  flex: 1;
  display: flex;
  flex-direction: column;
  padding: 1rem;
}

/* TOOLBAR */
.toolbar {
  display: flex;
  gap: 0.5rem;
  align-items: center;
  margin-bottom: 0.5rem;
}

button {
  background: #3a3d41;
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
}

button:hover { background: #505357; }

/* FILE BAR */
#file-bar {
  display: flex;
  gap: 0.5rem;
  align-items: center;
  margin-bottom: 0.5rem;
}

/* TABS */
#tabs {
  display: flex;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
}

.tab {
  padding: 6px 12px;
  background: #333;
  border-radius: 6px 6px 0 0;
  cursor: pointer;
}

.tab.active {
  background: #f0f0f0;
  color: #000;
  border-bottom: 2px solid #00aaff;
}

/* EDITOR */
#editor-wrapper {
  flex: 1;
  border: 1px solid #333;
  border-radius: 6px;
  overflow: hidden;
}

.CodeMirror {
  height: 100%;
  background: #f2f2f2;   /* LIGHT GREY */
  color: #000;
  font-size: 15px;
}

.CodeMirror-gutters {
  background: #e5e5e5;
  border-right: 1px solid #ccc;
}

/* OUTPUT */
#output-panel {
  margin-top: 0.5rem;
  background: #111;
  border-radius: 6px;
  padding: 0.5rem;
}

#output-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.3rem;
}

pre {
  background: #222;
  padding: 0.7rem;
  border-radius: 6px;
  max-height: 160px;
  overflow-y: auto;
  white-space: pre-wrap;
}

#status {
  margin-left: auto;
  font-size: 13px;
  color: #aaa;
}
</style>
</head>

<body>
<div id="app">

<!-- ================= LEFT PANEL ================= -->
<div id="problem-panel">

<h2 id="problem-title">LeetCode Problems</h2>

<button onclick="loadRandomProblem()">üé≤ Random</button>

<div style="margin-top:0.5rem;">
  <input id="search-input" placeholder="Search problem..." style="width:100%; padding:6px;">
  <button onclick="searchProblems()" style="width:100%; margin-top:0.3rem;">üîç Search</button>
</div>

<ul id="search-results"></ul>

<hr>

<h3>üìÅ Python Files</h3>
<select id="file-select" style="width:100%; margin-bottom:0.5rem;"></select>

<button onclick="loadSelectedFile()">üìÇ Load File</button>
<button onclick="previewFile()">üëÅ Preview</button>

<hr>

<h3>Preview</h3>
<div id="problem-preview">Select a problem or file‚Ä¶</div>

</div>

<!-- ================= RIGHT PANEL ================= -->
<div id="editor-panel">

<div class="toolbar">
  <button onclick="runCode()">‚ñ∂ Run</button>
  <button onclick="copyEditor()">üìã Copy Code</button>
  <button onclick="copyOutput()">üìã Copy Output</button>
  <span id="status">Loading Pyodide‚Ä¶</span>
</div>

<div id="tabs">
  <div class="tab active" onclick="switchTab('main')">Main Code</div>
  <div class="tab" onclick="switchTab('preview')">Preview</div>
</div>

<div id="editor-wrapper">
  <textarea id="code">print("Hello from Pyodide IDE!")</textarea>
</div>

<div id="output-panel">
  <div id="output-header"><strong>Output</strong></div>
  <pre id="output">(Output)</pre>
</div>

</div>
</div>

<script>
let editor;
let pyodideReady = false;
let loadedFiles = {};
let leetcodeData = [];
let currentTab = "main";

editor = CodeMirror.fromTextArea(document.getElementById("code"), {
  mode: "python",
  lineNumbers: true,
  indentUnit: 4,
  matchBrackets: true
});

/* ---------------- PYODIDE INIT ---------------- */

async function main() {
  window.pyodide = await loadPyodide();
  await pyodide.loadPackage(["numpy", "matplotlib"]);
  pyodideReady = true;
  document.getElementById("status").textContent = "Ready";

  await loadPythonFiles();

  try {
    const r = await fetch("leetcode_dataset_clean.json");
    leetcodeData = await r.json();
  } catch {
    document.getElementById("problem-preview").textContent = "Failed to load LeetCode dataset.";
  }
}
main();

/* -------- FILE LOADING -------- */

async function loadPythonFiles() {
  const files = ["hello_world.txt"];

  pyodide.FS.mkdir("python_text_files");
  const select = document.getElementById("file-select");
  select.innerHTML = "";

  for (const file of files) {
    const r = await fetch(`python_text_files/${file}`);
    const text = await r.text();

    pyodide.FS.writeFile(`python_text_files/${file}`, text);
    loadedFiles[file] = text;

    const opt = document.createElement("option");
    opt.value = file;
    opt.textContent = file;
    select.appendChild(opt);
  }
}

function loadSelectedFile() {
  const file = document.getElementById("file-select").value;
  editor.setValue(loadedFiles[file]);
  document.getElementById("problem-preview").textContent = loadedFiles[file];
}

function previewFile() {
  const file = document.getElementById("file-select").value;
  editor.setValue(loadedFiles[file]);
  document.getElementById("problem-preview").textContent = loadedFiles[file];
}

/* -------- LEETCODE LOGIC -------- */

function loadRandomProblem() {
  const p = leetcodeData[Math.floor(Math.random() * leetcodeData.length)];
  showProblem(p);
}

function searchProblems() {
  const q = document.getElementById("search-input").value.toLowerCase();
  const results = document.getElementById("search-results");
  results.innerHTML = "";

  leetcodeData.filter(p => p.title.toLowerCase().includes(q)).slice(0, 20)
    .forEach(p => {
      const li = document.createElement("li");
      li.textContent = p.title;
      li.style.cursor = "pointer";
      li.onclick = () => showProblem(p);
      results.appendChild(li);
    });
}

function showProblem(problem) {
  document.getElementById("problem-title").textContent = problem.title;

  const text = `Difficulty: ${problem.difficulty}\n\n${problem.content}`;
  document.getElementById("problem-preview").textContent = text;

  editor.setValue(`# ${problem.title}\n# Difficulty: ${problem.difficulty}\n\n`);
}

/* -------- TAB SYSTEM -------- */

function switchTab(tab) {
  currentTab = tab;
  document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
  document.querySelectorAll(".tab")[tab === "main" ? 0 : 1].classList.add("active");
}

/* -------- RUN CODE -------- */

async function runCode() {
  const output = document.getElementById("output");

  try {
    await pyodide.runPythonAsync(`import sys, io\nsys.stdout = io.StringIO()\nsys.stderr = sys.stdout`);
    await pyodide.runPythonAsync(editor.getValue());
    output.textContent = await pyodide.runPythonAsync("sys.stdout.getvalue()") || "(No output)";
  } catch (err) {
    output.textContent = err;
  }
}

/* -------- COPY -------- */

function copyEditor() {
  navigator.clipboard.writeText(editor.getValue());
}

function copyOutput() {
  navigator.clipboard.writeText(document.getElementById("output").textContent);
}
</script>
</body>
</html>